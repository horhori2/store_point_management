<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í¬ì¸íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f0f11;
      --surface: #1a1a1f;
      --surface2: #24242c;
      --border: #2e2e38;
      --accent: #7c6af5;
      --accent-dim: rgba(124,106,245,0.15);
      --accent-glow: rgba(124,106,245,0.35);
      --green: #34d27a;
      --green-dim: rgba(52,210,122,0.12);
      --red: #f55858;
      --red-dim: rgba(245,88,88,0.12);
      --yellow: #f5c842;
      --yellow-dim: rgba(245,200,66,0.12);
      --text: #e8e8f0;
      --text-muted: #6b6b7e;
      --text-dim: #9898ac;
      --radius: 10px;
      --shadow: 0 4px 24px rgba(0,0,0,0.4);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOGIN SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #loginScreen {
      display: flex;
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: var(--bg);
      position: relative;
      overflow: hidden;
    }
    #loginScreen::before {
      content: '';
      position: absolute;
      width: 600px; height: 600px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(124,106,245,0.12) 0%, transparent 70%);
      top: -200px; right: -200px;
      pointer-events: none;
    }
    #loginScreen::after {
      content: '';
      position: absolute;
      width: 400px; height: 400px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(52,210,122,0.07) 0%, transparent 70%);
      bottom: -100px; left: -100px;
      pointer-events: none;
    }
    .login-card {
      width: 100%; max-width: 400px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 40px 36px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.5);
      position: relative; z-index: 1;
      animation: fadeUp 0.4s ease;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .login-logo {
      text-align: center;
      margin-bottom: 32px;
    }
    .login-logo-mark {
      display: inline-flex;
      align-items: center; justify-content: center;
      width: 56px; height: 56px;
      background: var(--accent-dim);
      border: 1px solid rgba(124,106,245,0.3);
      border-radius: 14px;
      font-size: 24px;
      margin-bottom: 14px;
    }
    .login-logo-title {
      font-family: 'Space Mono', monospace;
      font-size: 13px; font-weight: 700;
      color: var(--accent);
      letter-spacing: 3px;
      text-transform: uppercase;
    }
    .login-logo-sub {
      font-size: 12px; color: var(--text-muted);
      margin-top: 4px;
    }
    .login-form-title {
      font-size: 20px; font-weight: 700;
      margin-bottom: 24px;
      color: var(--text);
    }
    .login-group {
      margin-bottom: 16px;
    }
    .login-label {
      display: block;
      font-size: 11px; font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 1.2px;
      text-transform: uppercase;
      margin-bottom: 7px;
    }
    .login-input {
      width: 100%;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-family: inherit;
      font-size: 15px;
      padding: 11px 14px;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }
    .login-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }
    .login-btn {
      width: 100%; margin-top: 8px;
      padding: 12px;
      background: var(--accent);
      border: none; border-radius: 8px;
      color: #fff;
      font-family: inherit; font-size: 15px; font-weight: 700;
      cursor: pointer;
      transition: background 0.15s, box-shadow 0.15s;
      letter-spacing: 0.5px;
    }
    .login-btn:hover { background: #6b5ae0; box-shadow: 0 0 20px var(--accent-glow); }
    .login-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    .login-error {
      margin-top: 12px;
      padding: 10px 14px;
      background: var(--red-dim);
      border: 1px solid rgba(245,88,88,0.3);
      border-radius: 8px;
      font-size: 13px; color: var(--red);
      display: none;
    }
    .login-error.show { display: block; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       APP SCREEN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #appScreen { display: none; }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      position: sticky; top: 0; z-index: 100;
      background: rgba(15,15,17,0.9);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 0 20px;
      height: 60px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .logo {
      font-family: 'Space Mono', monospace;
      font-size: 13px; font-weight: 700;
      color: var(--accent);
      letter-spacing: 2px;
      text-transform: uppercase;
    }
    .logo span { color: var(--text-muted); }
    .header-right { display: flex; align-items: center; gap: 12px; }
    .admin-badge {
      display: flex; align-items: center; gap: 7px;
      padding: 5px 12px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 20px;
      font-size: 12px; color: var(--text-dim);
    }
    .admin-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 6px var(--green);
    }
    .logout-btn {
      padding: 6px 12px;
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 7px;
      color: var(--text-muted); font-size: 12px;
      cursor: pointer; font-family: inherit;
      transition: all 0.15s;
    }
    .logout-btn:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }

    /* â”€â”€ LAYOUT â”€â”€ */
    .layout {
      display: grid;
      grid-template-columns: 210px 1fr;
      min-height: calc(100vh - 60px);
    }

    /* â”€â”€ SIDEBAR â”€â”€ */
    aside {
      border-right: 1px solid var(--border);
      padding: 20px 0;
      position: sticky; top: 60px;
      height: calc(100vh - 60px);
      overflow-y: auto;
    }
    .nav-section { padding: 0 10px; margin-bottom: 6px; }
    .nav-label {
      font-size: 10px; font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 2px; text-transform: uppercase;
      padding: 0 8px; margin-bottom: 5px;
    }
    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 10px; border-radius: 8px;
      cursor: pointer; font-size: 14px; color: var(--text-dim);
      transition: all 0.15s; user-select: none;
    }
    .nav-item:hover { background: var(--surface2); color: var(--text); }
    .nav-item.active { background: var(--accent-dim); color: var(--accent); font-weight: 500; }
    .nav-item .icon { font-size: 15px; width: 20px; text-align: center; flex-shrink: 0; }

    /* â”€â”€ MAIN â”€â”€ */
    main { padding: 26px 22px; overflow-x: hidden; }

    /* â”€â”€ STATS â”€â”€ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px; margin-bottom: 24px;
    }
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px 18px;
      transition: border-color 0.2s;
    }
    .stat-card:hover { border-color: var(--accent); }
    .stat-label {
      font-size: 10px; font-weight: 700;
      color: var(--text-muted);
      letter-spacing: 1.5px; text-transform: uppercase;
      margin-bottom: 7px;
    }
    .stat-value {
      font-family: 'Space Mono', monospace;
      font-size: 26px; font-weight: 700; line-height: 1;
    }
    .stat-value.accent { color: var(--accent); }
    .stat-value.green { color: var(--green); }

    /* â”€â”€ SECTION HEADER â”€â”€ */
    .section-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 14px;
    }
    .section-title { font-size: 15px; font-weight: 700; }

    /* â”€â”€ SEARCH â”€â”€ */
    .search-row { display: flex; gap: 8px; margin-bottom: 14px; }
    .search-wrap { flex: 1; position: relative; }
    .search-wrap .ico {
      position: absolute; left: 11px; top: 50%; transform: translateY(-50%);
      color: var(--text-muted); font-size: 13px; pointer-events: none;
    }
    input[type="text"], input[type="number"], input[type="password"], select, textarea {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text); font-family: inherit; font-size: 14px;
      padding: 9px 12px; outline: none;
      transition: border-color 0.15s;
    }
    input[type="text"]:focus, input[type="number"]:focus,
    input[type="password"]:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-dim);
    }
    .search-wrap input { padding-left: 34px; }
    select { cursor: pointer; }
    option { background: var(--surface2); }

    /* â”€â”€ BUTTONS â”€â”€ */
    .btn {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 8px 14px;
      border: none; border-radius: 8px;
      font-family: inherit; font-size: 13px; font-weight: 500;
      cursor: pointer; transition: all 0.15s; white-space: nowrap;
    }
    .btn-primary { background: var(--accent); color: #fff; }
    .btn-primary:hover { background: #6b5ae0; box-shadow: 0 0 14px var(--accent-glow); }
    .btn-ghost {
      background: transparent; color: var(--text-dim);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover { background: var(--surface2); color: var(--text); }
    .btn-green { background: var(--green); color: #000; font-weight: 600; }
    .btn-green:hover { background: #28c46e; }
    .btn-red { background: transparent; color: var(--red); border: 1px solid var(--red); }
    .btn-red:hover { background: var(--red-dim); }
    .btn-sm { padding: 5px 9px; font-size: 12px; }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; }

    /* â”€â”€ TABLE â”€â”€ */
    .table-wrap {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius); overflow: hidden;
    }
    table { width: 100%; border-collapse: collapse; }
    thead { background: var(--surface2); }
    th {
      padding: 10px 14px;
      text-align: left; font-size: 10px; font-weight: 700;
      color: var(--text-muted); letter-spacing: 1.5px; text-transform: uppercase;
      border-bottom: 1px solid var(--border);
    }
    td {
      padding: 12px 14px; font-size: 13px;
      border-bottom: 1px solid rgba(46,46,56,0.6); vertical-align: middle;
    }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr { transition: background 0.1s; }
    tbody tr:hover { background: rgba(124,106,245,0.04); }
    .member-no {
      font-family: 'Space Mono', monospace;
      font-size: 11px; color: var(--text-muted);
    }
    .points-badge {
      font-family: 'Space Mono', monospace;
      font-size: 13px; font-weight: 700; color: var(--green);
    }
    .actions { display: flex; gap: 5px; flex-wrap: wrap; }

    /* â”€â”€ BADGE â”€â”€ */
    .badge {
      display: inline-flex; align-items: center;
      padding: 3px 7px; border-radius: 4px;
      font-size: 11px; font-weight: 700; letter-spacing: 0.5px;
    }
    .badge-green { background: var(--green-dim); color: var(--green); }
    .badge-red   { background: var(--red-dim);   color: var(--red); }
    .badge-yellow{ background: var(--yellow-dim); color: var(--yellow); }
    .badge-accent{ background: var(--accent-dim); color: var(--accent); }

    /* â”€â”€ MODAL â”€â”€ */
    .modal-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.72);
      backdrop-filter: blur(4px);
      z-index: 500;
      display: flex; align-items: center; justify-content: center;
      padding: 16px;
      opacity: 0; pointer-events: none; transition: opacity 0.2s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: all; }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      width: 100%; max-width: 460px;
      max-height: 90vh; overflow-y: auto;
      box-shadow: var(--shadow);
      transform: translateY(14px); transition: transform 0.2s;
    }
    .modal-overlay.open .modal { transform: translateY(0); }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 18px 22px 14px;
      border-bottom: 1px solid var(--border);
    }
    .modal-title { font-size: 15px; font-weight: 700; }
    .modal-close {
      width: 28px; height: 28px;
      background: var(--surface2); border: none; border-radius: 6px;
      color: var(--text-muted); font-size: 17px; cursor: pointer;
      display: flex; align-items: center; justify-content: center; transition: all 0.15s;
    }
    .modal-close:hover { background: var(--red-dim); color: var(--red); }
    .modal-body { padding: 18px 22px; }
    .modal-footer {
      display: flex; justify-content: flex-end; gap: 8px;
      padding: 14px 22px; border-top: 1px solid var(--border);
    }

    /* â”€â”€ FORM â”€â”€ */
    .form-group { margin-bottom: 14px; }
    .form-label {
      display: block; font-size: 11px; font-weight: 700;
      color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px;
    }
    .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast-container {
      position: fixed; bottom: 22px; right: 22px;
      z-index: 999; display: flex; flex-direction: column; gap: 7px;
    }
    .toast {
      display: flex; align-items: center; gap: 9px;
      padding: 11px 15px;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 9px; font-size: 13px; box-shadow: var(--shadow);
      animation: slideIn 0.22s ease;
      min-width: 220px; max-width: 320px;
    }
    .toast.success { border-color: var(--green); }
    .toast.error { border-color: var(--red); }
    .toast-icon { font-size: 15px; flex-shrink: 0; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(14px); }
      to   { opacity: 1; transform: translateX(0); }
    }

    /* â”€â”€ HISTORY â”€â”€ */
    .history-list { display: flex; flex-direction: column; gap: 7px; }
    .history-item {
      display: flex; align-items: center;
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 8px; padding: 11px 13px; gap: 10px;
    }
    .history-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
    .history-info { flex: 1; min-width: 0; }
    .history-type { font-size: 13px; font-weight: 500; }
    .history-note { font-size: 11px; color: var(--text-muted); }
    .history-date { font-size: 11px; color: var(--text-muted); }
    .history-amount { font-family: 'Space Mono', monospace; font-size: 13px; font-weight: 700; text-align: right; flex-shrink: 0; }

    /* â”€â”€ EMPTY â”€â”€ */
    .empty { text-align: center; padding: 44px 24px; color: var(--text-muted); }
    .empty-icon { font-size: 32px; margin-bottom: 10px; opacity: 0.35; }
    .empty-text { font-size: 13px; }

    /* â”€â”€ PAGE â”€â”€ */
    .page { display: none; }
    .page.active { display: block; }

    /* â”€â”€ ADMIN TABLE â”€â”€ */
    .admin-me-tag {
      display: inline-flex; align-items: center; gap: 4px;
      padding: 2px 7px; border-radius: 10px;
      font-size: 10px; font-weight: 700;
      background: var(--accent-dim); color: var(--accent);
      margin-left: 6px; letter-spacing: 0.5px;
    }

    /* â”€â”€ RESPONSIVE â”€â”€ */
    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
      aside {
        position: fixed; top: 60px; left: 0; bottom: 0;
        width: 210px; z-index: 200;
        background: var(--bg);
        transform: translateX(-100%); transition: transform 0.25s;
      }
      aside.open { transform: translateX(0); box-shadow: 4px 0 24px rgba(0,0,0,0.5); }
      .mobile-menu-btn {
        display: flex !important;
        align-items: center; justify-content: center;
        width: 34px; height: 34px;
        background: var(--surface2); border: 1px solid var(--border);
        border-radius: 7px; cursor: pointer; color: var(--text); font-size: 17px;
      }
      .sidebar-overlay {
        display: block !important;
        position: fixed; inset: 0; top: 60px;
        background: rgba(0,0,0,0.5);
        z-index: 199; opacity: 0; pointer-events: none; transition: opacity 0.25s;
      }
      .sidebar-overlay.open { opacity: 1; pointer-events: all; }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      main { padding: 18px 14px; }
      th:nth-child(5), td:nth-child(5) { display: none; }
      .admin-badge span.uname { display: none; }
    }
    @media (max-width: 560px) {
      .stats-grid { grid-template-columns: 1fr; }
      th:nth-child(1), td:nth-child(1) { display: none; }
      .btn-sm { padding: 4px 7px; font-size: 11px; }
      .modal { border-radius: 12px 12px 0 0; max-width: 100%; }
      .modal-overlay { align-items: flex-end; padding: 0; }
      .login-card { padding: 30px 22px; }
    }
    .mobile-menu-btn { display: none; }
    .sidebar-overlay { display: none; }
  </style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen">
  <div class="login-card">
    <div class="login-logo">
      <div class="login-logo-mark">ğŸ’</div>
      <div class="login-logo-title">POINT SYSTEM</div>
      <div class="login-logo-sub">ê´€ë¦¬ì ì „ìš© ì‹œìŠ¤í…œ</div>
    </div>
    <div class="login-form-title">ê´€ë¦¬ì ë¡œê·¸ì¸</div>
    <div class="login-group">
      <label class="login-label">ì•„ì´ë””</label>
      <input class="login-input" type="text" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="username" />
    </div>
    <div class="login-group">
      <label class="login-label">ë¹„ë°€ë²ˆí˜¸</label>
      <input class="login-input" type="password" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" autocomplete="current-password" />
    </div>
    <button class="login-btn" id="loginBtn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <div class="login-error" id="loginError"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     APP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="appScreen">
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <button class="mobile-menu-btn" id="menuBtn">â˜°</button>
      <div class="logo">POINT<span> /</span> SYSTEM</div>
    </div>
    <div class="header-right">
      <div class="admin-badge">
        <div class="admin-dot"></div>
        <span class="uname" id="headerAdminName">â€”</span>
      </div>
      <button class="logout-btn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>

  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="layout">
    <aside id="sidebar">
      <div class="nav-section">
        <div class="nav-label">ë©”ë‰´</div>
        <div class="nav-item active" data-page="dashboard">
          <span class="icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
        </div>
        <div class="nav-item" data-page="members">
          <span class="icon">ğŸ‘¥</span> íšŒì› ê´€ë¦¬
        </div>
        <div class="nav-item" data-page="admins">
          <span class="icon">ğŸ”</span> ê´€ë¦¬ì ê³„ì •
        </div>
      </div>
    </aside>

    <main>
      <!-- ëŒ€ì‹œë³´ë“œ -->
      <div class="page active" id="page-dashboard">
        <div class="section-header" style="margin-bottom:18px">
          <div>
            <div class="section-title">ëŒ€ì‹œë³´ë“œ</div>
            <div style="font-size:12px;color:var(--text-muted);margin-top:2px">ì „ì²´ í¬ì¸íŠ¸ í˜„í™©</div>
          </div>
          <button class="btn btn-ghost btn-sm" onclick="loadStats()">â†» ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">ì „ì²´ íšŒì›</div>
            <div class="stat-value accent" id="stat-total">â€”</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ì´ ë³´ìœ  í¬ì¸íŠ¸</div>
            <div class="stat-value green" id="stat-points">â€”</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ì˜¤ëŠ˜ ì‹ ê·œ</div>
            <div class="stat-value" id="stat-today">â€”</div>
          </div>
        </div>
        <div class="section-header">
          <div class="section-title">ì „ì²´ íšŒì› ëª©ë¡</div>
        </div>
        <div class="table-wrap" id="dash-table-wrap">
          <div class="empty"><div class="empty-icon">â³</div><div class="empty-text">ë¡œë”© ì¤‘...</div></div>
        </div>
      </div>

      <!-- íšŒì› ê´€ë¦¬ -->
      <div class="page" id="page-members">
        <div class="section-header" style="margin-bottom:18px">
          <div>
            <div class="section-title">íšŒì› ê´€ë¦¬</div>
            <div style="font-size:12px;color:var(--text-muted);margin-top:2px">íšŒì› ë“±ë¡ ë° í¬ì¸íŠ¸ ê´€ë¦¬</div>
          </div>
          <button class="btn btn-primary" onclick="openAddModal()">ï¼‹ íšŒì› ë“±ë¡</button>
        </div>
        <div class="search-row">
          <div class="search-wrap">
            <span class="ico">ğŸ”</span>
            <input type="text" id="searchInput" placeholder="ì´ë¦„ ë˜ëŠ” íšŒì›ë²ˆí˜¸ ê²€ìƒ‰..." oninput="debounceSearch()" />
          </div>
          <button class="btn btn-ghost" onclick="loadMembers()">â†»</button>
        </div>
        <div class="table-wrap" id="member-table-wrap">
          <div class="empty"><div class="empty-icon">â³</div><div class="empty-text">ë¡œë”© ì¤‘...</div></div>
        </div>
      </div>

      <!-- ê´€ë¦¬ì ê³„ì • -->
      <div class="page" id="page-admins">
        <div class="section-header" style="margin-bottom:18px">
          <div>
            <div class="section-title">ê´€ë¦¬ì ê³„ì •</div>
            <div style="font-size:12px;color:var(--text-muted);margin-top:2px">ê´€ë¦¬ì ìƒì„± ë° ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬</div>
          </div>
          <button class="btn btn-primary" onclick="openAddAdminModal()">ï¼‹ ê´€ë¦¬ì ì¶”ê°€</button>
        </div>
        <div class="table-wrap" id="admin-table-wrap">
          <div class="empty"><div class="empty-icon">â³</div><div class="empty-text">ë¡œë”© ì¤‘...</div></div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- â”€â”€ íšŒì› ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="memberModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="memberModalTitle">íšŒì› ë“±ë¡</div>
      <button class="modal-close" onclick="closeModal('memberModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">íšŒì›ë²ˆí˜¸</label>
        <input type="text" id="f-member-no" placeholder="ì˜ˆ: M20240001" />
      </div>
      <div class="form-group">
        <label class="form-label">ì´ë¦„</label>
        <input type="text" id="f-name" placeholder="íšŒì› ì´ë¦„" />
      </div>
      <div class="form-group" id="f-points-group">
        <label class="form-label">ì´ˆê¸° í¬ì¸íŠ¸</label>
        <input type="number" id="f-points" placeholder="0" min="0" />
        <div class="form-hint">ë“±ë¡ ì‹œ ì§€ê¸‰í•  ì´ˆê¸° í¬ì¸íŠ¸ (ì„ íƒ)</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('memberModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" id="memberModalSubmit" onclick="submitMember()">ë“±ë¡</button>
    </div>
  </div>
</div>

<!-- â”€â”€ í¬ì¸íŠ¸ ë³€ê²½ ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="pointModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">í¬ì¸íŠ¸ ë³€ê²½</div>
      <button class="modal-close" onclick="closeModal('pointModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div style="background:var(--surface2);border-radius:8px;padding:13px 15px;margin-bottom:16px;border:1px solid var(--border)">
        <div style="font-size:11px;color:var(--text-muted);margin-bottom:3px">ëŒ€ìƒ íšŒì›</div>
        <div style="font-weight:700;font-size:14px" id="point-member-name">â€”</div>
        <div style="font-family:'Space Mono',monospace;font-size:18px;font-weight:700;color:var(--green);margin-top:5px">
          í˜„ì¬: <span id="point-current">0</span> P
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">ë³€ê²½ ìœ í˜•</label>
        <select id="f-point-type">
          <option value="ì ë¦½">ğŸ“ˆ ì ë¦½</option>
          <option value="ì‚¬ìš©">ğŸ“‰ ì‚¬ìš©</option>
          <option value="ì¡°ì •">âš™ï¸ í¬ì¸íŠ¸ ì¡°ì •</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label" id="f-amount-label">ì ë¦½ í¬ì¸íŠ¸ (P)</label>
        <input type="number" id="f-amount" placeholder="0" min="0" />
        <div class="form-hint" id="f-amount-hint">ì ë¦½í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>
      </div>
      <div class="form-group">
        <label class="form-label">ë©”ëª¨ (ì„ íƒ)</label>
        <input type="text" id="f-note" placeholder="ë³€ê²½ ì‚¬ìœ ..." />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('pointModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="submitPoint()">ë³€ê²½</button>
    </div>
  </div>
</div>

<!-- â”€â”€ í¬ì¸íŠ¸ ë‚´ì—­ ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="historyModal">
  <div class="modal" style="max-width:500px">
    <div class="modal-header">
      <div>
        <div class="modal-title" id="history-title">í¬ì¸íŠ¸ ë‚´ì—­</div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:2px" id="history-sub"></div>
      </div>
      <button class="modal-close" onclick="closeModal('historyModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div id="history-list-wrap"><div class="empty"><div class="empty-icon">â³</div></div></div>
    </div>
  </div>
</div>

<!-- â”€â”€ íšŒì› ì‚­ì œ í™•ì¸ ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="confirmModal">
  <div class="modal" style="max-width:360px">
    <div class="modal-header">
      <div class="modal-title">ì‚­ì œ í™•ì¸</div>
      <button class="modal-close" onclick="closeModal('confirmModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <p style="font-size:13px;color:var(--text-dim);line-height:1.7" id="confirmText"></p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('confirmModal')">ì·¨ì†Œ</button>
      <button class="btn btn-red" id="confirmBtn">ì‚­ì œ</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ê´€ë¦¬ì ì¶”ê°€ ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="adminAddModal">
  <div class="modal" style="max-width:400px">
    <div class="modal-header">
      <div class="modal-title">ê´€ë¦¬ì ì¶”ê°€</div>
      <button class="modal-close" onclick="closeModal('adminAddModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ì•„ì´ë””</label>
        <input type="text" id="new-admin-id" placeholder="ì˜ë¬¸, ìˆ«ì ì¡°í•©" autocomplete="off" />
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="new-admin-pw" placeholder="4ì ì´ìƒ" autocomplete="new-password" />
      </div>
      <div class="form-group">
        <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="new-admin-pw2" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" autocomplete="new-password" />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('adminAddModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="submitAddAdmin()">ì¶”ê°€</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ëª¨ë‹¬ â”€â”€ -->
<div class="modal-overlay" id="adminPwModal">
  <div class="modal" style="max-width:380px">
    <div class="modal-header">
      <div>
        <div class="modal-title">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:2px" id="pw-admin-name"></div>
      </div>
      <button class="modal-close" onclick="closeModal('adminPwModal')">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
        <input type="password" id="change-pw" placeholder="4ì ì´ìƒ" autocomplete="new-password" />
      </div>
      <div class="form-group">
        <label class="form-label">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="change-pw2" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥" autocomplete="new-password" />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('adminPwModal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="submitChangePw()">ë³€ê²½</button>
    </div>
  </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
const API = '';
let editingId = null;
let currentMemberId = null;
let currentAdminId = null;
let currentAdminUsername = '';
let searchTimer = null;
let myAdminId = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function checkSession() {
  try {
    const res = await fetch(API + '/api/auth/me');
    if (res.ok) {
      const data = await res.json();
      showApp(data.username);
    } else {
      showLogin();
    }
  } catch { showLogin(); }
}

function showLogin() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('appScreen').style.display = 'none';
  setTimeout(() => document.getElementById('loginId').focus(), 100);
}

function showApp(username) {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('appScreen').style.display = 'block';
  document.getElementById('headerAdminName').textContent = username;
  loadStats(); loadDashboard();
  // í˜„ì¬ ë‚´ ID íŒŒì•… (ê´€ë¦¬ì ëª©ë¡ì—ì„œ ë³¸ì¸ í‘œì‹œìš©)
  fetch(API + '/api/admins').then(r => r.json()).then(d => {
    const me = d.data.find(a => a.username === username);
    if (me) myAdminId = me.id;
  }).catch(() => {});
}

async function doLogin() {
  const username = document.getElementById('loginId').value.trim();
  const password = document.getElementById('loginPw').value;
  const errEl = document.getElementById('loginError');
  const btn = document.getElementById('loginBtn');

  if (!username || !password) {
    errEl.textContent = 'ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
    errEl.classList.add('show'); return;
  }

  btn.disabled = true; btn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';
  errEl.classList.remove('show');

  try {
    const res = await fetch(API + '/api/auth/login', {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });
    const data = await res.json();
    if (data.success) {
      document.getElementById('loginPw').value = '';
      showApp(data.username);
    } else {
      errEl.textContent = data.message;
      errEl.classList.add('show');
    }
  } catch {
    errEl.textContent = 'ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
    errEl.classList.add('show');
  } finally {
    btn.disabled = false; btn.textContent = 'ë¡œê·¸ì¸';
  }
}

async function doLogout() {
  await fetch(API + '/api/auth/logout', { method: 'POST' });
  document.getElementById('loginId').value = '';
  document.getElementById('loginPw').value = '';
  showLogin();
}

// ì—”í„°í‚¤ë¡œ ë¡œê·¸ì¸
['loginId','loginPw'].forEach(id => {
  document.getElementById(id).addEventListener('keydown', e => {
    if (e.key === 'Enter') doLogin();
  });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    item.classList.add('active');
    const page = item.dataset.page;
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    closeSidebar();
    if (page === 'dashboard') { loadStats(); loadDashboard(); }
    if (page === 'members') loadMembers();
    if (page === 'admins') loadAdmins();
  });
});

const menuBtn = document.getElementById('menuBtn');
const sidebar = document.getElementById('sidebar');
const sidebarOverlay = document.getElementById('sidebarOverlay');
menuBtn.addEventListener('click', () => {
  sidebar.classList.toggle('open');
  sidebarOverlay.classList.toggle('open');
});
sidebarOverlay.addEventListener('click', closeSidebar);
function closeSidebar() {
  sidebar.classList.remove('open');
  sidebarOverlay.classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST / MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function toast(msg, type = 'success') {
  const el = document.createElement('div');
  el.className = 'toast ' + type;
  el.innerHTML = `<span class="toast-icon">${type === 'success' ? 'âœ“' : 'âœ•'}</span><span>${msg}</span>`;
  document.getElementById('toastContainer').appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.classList.remove('open'); });
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const fmt = n => Number(n).toLocaleString('ko-KR');
function escHtml(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escAttr(s) { return String(s).replace(/'/g,"\\'"); }

async function apiReq(url, opts = {}) {
  const res = await fetch(API + url, { ...opts, headers: { 'Content-Type': 'application/json', ...(opts.headers||{}) } });
  const data = await res.json();
  if (!res.ok && data.code === 'UNAUTHORIZED') { doLogout(); throw new Error('SESSION_EXPIRED'); }
  return { ok: res.ok, data };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadStats() {
  try {
    const { data } = await apiReq('/api/stats');
    document.getElementById('stat-total').textContent = fmt(data.data.totalMembers);
    document.getElementById('stat-points').textContent = fmt(data.data.totalPoints);
    document.getElementById('stat-today').textContent = fmt(data.data.todayNew);
  } catch {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadDashboard() {
  const wrap = document.getElementById('dash-table-wrap');
  try {
    const { data } = await apiReq('/api/members');
    wrap.innerHTML = renderMemberTable(data.data, false);
  } catch { wrap.innerHTML = '<div class="empty"><div class="empty-text">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div></div>'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MEMBERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadMembers(search = '') {
  const wrap = document.getElementById('member-table-wrap');
  try {
    const url = '/api/members' + (search ? '?search=' + encodeURIComponent(search) : '');
    const { data } = await apiReq(url);
    wrap.innerHTML = renderMemberTable(data.data, true);
  } catch { wrap.innerHTML = '<div class="empty"><div class="empty-text">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div></div>'; }
}

function renderMemberTable(data, showActions) {
  if (!data.length) {
    return '<div class="empty"><div class="empty-icon">ğŸ‘¤</div><div class="empty-text">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>';
  }
  return `<table><thead><tr>
    <th>#</th><th>íšŒì›ë²ˆí˜¸</th><th>ì´ë¦„</th><th>ë³´ìœ  í¬ì¸íŠ¸</th><th>ë“±ë¡ì¼</th>
    ${showActions ? '<th>ê´€ë¦¬</th>' : ''}
  </tr></thead><tbody>
  ${data.map((m, i) => `<tr>
    <td style="color:var(--text-muted);font-size:11px">${i+1}</td>
    <td><span class="member-no">${escHtml(m.member_no)}</span></td>
    <td><strong>${escHtml(m.name)}</strong></td>
    <td><span class="points-badge">${fmt(m.points)} P</span></td>
    <td style="font-size:11px;color:var(--text-muted)">${(m.created_at||'').slice(0,10)}</td>
    ${showActions ? `<td><div class="actions">
      <button class="btn btn-green btn-sm" onclick="openPointModal(${m.id},'${escAttr(m.name)}',${m.points})">ğŸ’° í¬ì¸íŠ¸</button>
      <button class="btn btn-ghost btn-sm" onclick="openHistoryModal(${m.id},'${escAttr(m.name)}',${m.points})">ğŸ“‹ ë‚´ì—­</button>
      <button class="btn btn-ghost btn-sm" onclick="openEditModal(${m.id},'${escAttr(m.member_no)}','${escAttr(m.name)}')">âœï¸</button>
      <button class="btn btn-red btn-sm" onclick="openConfirm(${m.id},'${escAttr(m.name)}')">ğŸ—‘ï¸</button>
    </div></td>` : ''}
  </tr>`).join('')}
  </tbody></table>`;
}

function debounceSearch() {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(() => loadMembers(document.getElementById('searchInput').value), 300);
}

function openAddModal() {
  editingId = null;
  document.getElementById('memberModalTitle').textContent = 'íšŒì› ë“±ë¡';
  document.getElementById('memberModalSubmit').textContent = 'ë“±ë¡';
  document.getElementById('f-member-no').value = '';
  document.getElementById('f-name').value = '';
  document.getElementById('f-points').value = '';
  document.getElementById('f-points-group').style.display = '';
  openModal('memberModal');
  setTimeout(() => document.getElementById('f-member-no').focus(), 80);
}

function openEditModal(id, memberNo, name) {
  editingId = id;
  document.getElementById('memberModalTitle').textContent = 'íšŒì› ìˆ˜ì •';
  document.getElementById('memberModalSubmit').textContent = 'ì €ì¥';
  document.getElementById('f-member-no').value = memberNo;
  document.getElementById('f-name').value = name;
  document.getElementById('f-points-group').style.display = 'none';
  openModal('memberModal');
}

async function submitMember() {
  const member_no = document.getElementById('f-member-no').value.trim();
  const name = document.getElementById('f-name').value.trim();
  const points = parseInt(document.getElementById('f-points').value) || 0;
  if (!member_no || !name) { toast('íšŒì›ë²ˆí˜¸ì™€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error'); return; }
  try {
    let res;
    if (editingId) {
      res = await apiReq('/api/members/' + editingId, { method: 'PUT', body: JSON.stringify({ member_no, name }) });
    } else {
      res = await apiReq('/api/members', { method: 'POST', body: JSON.stringify({ member_no, name, points }) });
    }
    if (res.data.success) {
      toast(res.data.message);
      closeModal('memberModal');
      loadMembers(document.getElementById('searchInput').value);
      loadStats();
    } else { toast(res.data.message, 'error'); }
  } catch (e) { if (e.message !== 'SESSION_EXPIRED') toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
}

function openPointModal(id, name, points) {
  currentMemberId = id;
  document.getElementById('point-member-name').textContent = name;
  document.getElementById('point-current').textContent = fmt(points);
  document.getElementById('f-point-type').value = 'ì ë¦½';
  document.getElementById('f-amount').value = '';
  document.getElementById('f-note').value = '';
  updateAmountHint();
  openModal('pointModal');
  setTimeout(() => document.getElementById('f-amount').focus(), 80);
}

document.getElementById('f-point-type').addEventListener('change', updateAmountHint);
function updateAmountHint() {
  const type = document.getElementById('f-point-type').value;
  const hints = { 'ì ë¦½': 'ì ë¦½í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'ì‚¬ìš©': 'ì°¨ê°í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'ì¡°ì •': 'ìµœì¢… í¬ì¸íŠ¸ ê°’ì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”.' };
  const labels = { 'ì ë¦½': 'ì ë¦½ í¬ì¸íŠ¸ (P)', 'ì‚¬ìš©': 'ì‚¬ìš© í¬ì¸íŠ¸ (P)', 'ì¡°ì •': 'ì¡°ì • í›„ í¬ì¸íŠ¸ (P)' };
  document.getElementById('f-amount-hint').textContent = hints[type];
  document.getElementById('f-amount-label').textContent = labels[type];
}

async function submitPoint() {
  const type = document.getElementById('f-point-type').value;
  const amount = parseInt(document.getElementById('f-amount').value);
  const note = document.getElementById('f-note').value.trim();
  if (isNaN(amount) || amount < 0) { toast('ì˜¬ë°”ë¥¸ í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error'); return; }
  try {
    const res = await apiReq('/api/members/' + currentMemberId + '/points', {
      method: 'POST', body: JSON.stringify({ type, amount, note })
    });
    if (res.data.success) {
      toast(`í¬ì¸íŠ¸ ë³€ê²½ ì™„ë£Œ. í˜„ì¬: ${fmt(res.data.points)} P`);
      closeModal('pointModal');
      loadMembers(document.getElementById('searchInput').value);
      loadStats();
    } else { toast(res.data.message, 'error'); }
  } catch (e) { if (e.message !== 'SESSION_EXPIRED') toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
}

async function openHistoryModal(id, name, points) {
  document.getElementById('history-title').textContent = name + ' ë‹˜ í¬ì¸íŠ¸ ë‚´ì—­';
  document.getElementById('history-sub').textContent = 'í˜„ì¬ ë³´ìœ : ' + fmt(points) + ' P';
  document.getElementById('history-list-wrap').innerHTML = '<div class="empty"><div class="empty-icon">â³</div></div>';
  openModal('historyModal');
  try {
    const { data } = await apiReq('/api/members/' + id + '/history');
    if (!data.data.length) {
      document.getElementById('history-list-wrap').innerHTML =
        '<div class="empty"><div class="empty-icon">ğŸ“­</div><div class="empty-text">í¬ì¸íŠ¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div></div>';
      return;
    }
    document.getElementById('history-list-wrap').innerHTML = `<div class="history-list">
      ${data.data.map(h => {
        const isAdd = h.type === 'ì ë¦½', isUse = h.type === 'ì‚¬ìš©';
        const color = isAdd ? 'var(--green)' : isUse ? 'var(--red)' : 'var(--yellow)';
        const prefix = isAdd ? '+' : isUse ? '-' : 'â†’';
        return `<div class="history-item">
          <div class="history-dot" style="background:${color}"></div>
          <div class="history-info">
            <div class="history-type">
              <span class="badge ${isAdd ? 'badge-green' : isUse ? 'badge-red' : 'badge-yellow'}">${h.type}</span>
              ${h.note ? `<span style="margin-left:5px;font-size:11px;color:var(--text-dim)">${escHtml(h.note)}</span>` : ''}
            </div>
            <div class="history-date">${h.created_at || ''}</div>
          </div>
          <div class="history-amount" style="color:${color}">${prefix}${fmt(Math.abs(h.amount))} P</div>
        </div>`;
      }).join('')}
    </div>`;
  } catch {}
}

function openConfirm(id, name) {
  document.getElementById('confirmText').innerHTML =
    `<strong style="color:var(--text)">${escHtml(name)}</strong> íšŒì›ì„ ì‚­ì œí•˜ë©´ ëª¨ë“  í¬ì¸íŠ¸ ë‚´ì—­ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.<br>ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
  document.getElementById('confirmBtn').onclick = async () => {
    try {
      const res = await apiReq('/api/members/' + id, { method: 'DELETE' });
      if (res.data.success) {
        toast('íšŒì›ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        closeModal('confirmModal');
        loadMembers(document.getElementById('searchInput').value);
        loadStats();
      } else { toast(res.data.message, 'error'); }
    } catch {}
  };
  openModal('confirmModal');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADMINS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadAdmins() {
  const wrap = document.getElementById('admin-table-wrap');
  try {
    const { data } = await apiReq('/api/admins');
    const list = data.data;
    if (!list.length) {
      wrap.innerHTML = '<div class="empty"><div class="empty-text">ê´€ë¦¬ìê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>';
      return;
    }
    wrap.innerHTML = `<table><thead><tr>
      <th>#</th><th>ì•„ì´ë””</th><th>ë“±ë¡ì¼</th><th>ê´€ë¦¬</th>
    </tr></thead><tbody>
    ${list.map((a, i) => {
      const isMe = a.id === myAdminId;
      return `<tr>
        <td style="color:var(--text-muted);font-size:11px">${i+1}</td>
        <td>
          <strong>${escHtml(a.username)}</strong>
          ${isMe ? '<span class="admin-me-tag">ë‚˜</span>' : ''}
        </td>
        <td style="font-size:11px;color:var(--text-muted)">${(a.created_at||'').slice(0,10)}</td>
        <td><div class="actions">
          <button class="btn btn-ghost btn-sm" onclick="openChangePwModal(${a.id},'${escAttr(a.username)}')">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
          ${!isMe ? `<button class="btn btn-red btn-sm" onclick="deleteAdmin(${a.id},'${escAttr(a.username)}')">ğŸ—‘ï¸ ì‚­ì œ</button>` : ''}
        </div></td>
      </tr>`;
    }).join('')}
    </tbody></table>`;
  } catch { wrap.innerHTML = '<div class="empty"><div class="empty-text">ë¡œë“œ ì‹¤íŒ¨</div></div>'; }
}

function openAddAdminModal() {
  document.getElementById('new-admin-id').value = '';
  document.getElementById('new-admin-pw').value = '';
  document.getElementById('new-admin-pw2').value = '';
  openModal('adminAddModal');
  setTimeout(() => document.getElementById('new-admin-id').focus(), 80);
}

async function submitAddAdmin() {
  const username = document.getElementById('new-admin-id').value.trim();
  const password = document.getElementById('new-admin-pw').value;
  const password2 = document.getElementById('new-admin-pw2').value;
  if (!username) { toast('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error'); return; }
  if (password.length < 4) { toast('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error'); return; }
  if (password !== password2) { toast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error'); return; }
  try {
    const res = await apiReq('/api/admins', { method: 'POST', body: JSON.stringify({ username, password }) });
    if (res.data.success) {
      toast('ê´€ë¦¬ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      closeModal('adminAddModal');
      loadAdmins();
    } else { toast(res.data.message, 'error'); }
  } catch (e) { if (e.message !== 'SESSION_EXPIRED') toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
}

function openChangePwModal(id, username) {
  currentAdminId = id;
  document.getElementById('pw-admin-name').textContent = '@' + username;
  document.getElementById('change-pw').value = '';
  document.getElementById('change-pw2').value = '';
  openModal('adminPwModal');
  setTimeout(() => document.getElementById('change-pw').focus(), 80);
}

async function submitChangePw() {
  const password = document.getElementById('change-pw').value;
  const password2 = document.getElementById('change-pw2').value;
  if (password.length < 4) { toast('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error'); return; }
  if (password !== password2) { toast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error'); return; }
  try {
    const res = await apiReq('/api/admins/' + currentAdminId + '/password', {
      method: 'PUT', body: JSON.stringify({ password })
    });
    if (res.data.success) {
      toast('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
      closeModal('adminPwModal');
    } else { toast(res.data.message, 'error'); }
  } catch (e) { if (e.message !== 'SESSION_EXPIRED') toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
}

async function deleteAdmin(id, username) {
  if (!confirm(`'${username}' ê´€ë¦¬ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
  try {
    const res = await apiReq('/api/admins/' + id, { method: 'DELETE' });
    if (res.data.success) {
      toast('ê´€ë¦¬ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
      loadAdmins();
    } else { toast(res.data.message, 'error'); }
  } catch (e) { if (e.message !== 'SESSION_EXPIRED') toast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error'); }
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€
checkSession();
</script>
</body>
</html>
